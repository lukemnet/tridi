/*
  Tridi v1.0.1 - JavaScript 360 3D Product Viewer
  Author: Lukasz Wojcik
  License: MIT
  Homepage: https://tridi.lukem.net
  GitHub: http://github.com/lukemnet/tridi
*/
var Tridi=function(){function t(t){var e=this;this.setElementName=function(){return"string"==typeof e.element?e.element.substr(1):e.element.getAttribute("id")?e.element.getAttribute("id"):e.element.getAttribute("class")?e.element.getAttribute("class"):"unnamedTridi"},this.validate=function(t){t.element||console.error("'element' property is missing or invalid. Container element must be specified."),void 0===t.images&&void 0===t.format&&console.error("'format' property is missing or invalid. Image format must be provided for 'numbered' property."),"numbered"!==t.images||t.location||console.error("'location' property is missing or invalid. Image location must be provided for 'numbered' property.")},this.validate(t),this.element=t.element,this.images=t.images||"numbered",this.format=t.format||void 0,this.location=t.location||"./images",this.count=Array.isArray(this.images)?this.images.length:t.count,this.draggable=void 0===t.draggable||t.draggable,this.keys=t.keys||!1,this.hintOnStartup=t.hintOnStartup||!1,this.hintText=t.hintText||null,this.focusOnHintClose=t.focusOnHintClose||!1,this.lazy=t.lazy||!1,this.autoplay=t.autoplay||!1,this.autoplaySpeed=void 0!==t.autoplaySpeed?t.autoplaySpeed:50,this.stopAutoplayOnClick=t.stopAutoplayOnClick||!1,this.stopAutoplayOnMouseenter=t.stopAutoplayOnMouseenter||!1,this.resumeAutoplayOnMouseleave=t.resumeAutoplayOnMouseleave||!1,this.resumeAutoplayDelay=t.resumeAutoplayDelay||0,this.passive=void 0===t.passive||t.passive,this.spinner=t.spinner||!1,this.touch=void 0===t.touch||t.touch,this.mousewheel=t.mousewheel||!1,this.inverse=t.inverse||!1,this.dragInterval=t.dragInterval||1,this.touchDragInterval=t.touchDragInterval||2,this.mouseleaveDetect=t.mouseleaveDetect||!1,this.elementName=this.setElementName(),this.imageIndex=1,this.moveBuffer=[],this.dragActive=!1,this.intervals=[],this.timeouts=[],this.stashedImgs=0}return t.prototype.validateUpdate=function(t){return!!(t.images||t.format||t.count||t.location)||(console.error("UpdatableOptions object doesn't contain options that can be updated."),!1)},t.prototype.updateOptions=function(e){var i=this;Object.keys(e).forEach(function(t){i[t]=e[t],e[t].constructor===Array&&(i.count=e[t].length)})},t.prototype.getElem=function(t){return"string"==typeof this.element?t?document.querySelector(this.element+" "+t):document.querySelector(this.element):this.element},t.prototype.viewer=function(){return this.getElem()},t.prototype.stash=function(){return this.getElem(".tridi-stash")},t.prototype.getHintOverlay=function(){return this.getElem(".tridi-hint-overlay")},t.prototype.getLoadingScreen=function(){return this.getElem(".tridi-loading")},t.prototype.image=function(t){return this.imgs()[t-1]},t.prototype.viewerImage=function(){return this.getElem(".tridi-viewer-image")},t.prototype.lazyLoad=function(t,e){this.lazy&&!e?(this.viewerImage().addEventListener("click",t),this.touch&&this.viewerImage().addEventListener("touchstart",t,{passive:this.passive})):t()},t.prototype.imgs=function(){var i=this;return"numbered"===this.images?Array.apply(null,{length:this.count}).map(function(t,e){return i.location+"/"+(e+1)+"."+i.format.toLowerCase()}):this.images},t.prototype.generateViewer=function(){var t=this.viewer();t&&(t.className+=" tridi-viewer tridi-"+this.elementName+"-viewer tridi-draggable-"+this.draggable+" tridi-touch-"+this.touch+" tridi-mousewheel-"+this.mousewheel+" tridi-hintOnStartup-"+this.hintOnStartup+" tridi-lazy-"+this.lazy)},t.prototype.generateLoadingScreen=function(){var t=document.createElement("div");t.className+="tridi-loading tridi-"+this.elementName+"-loading",t.style.display="none";var e=document.createElement("div");e.className+="tridi-spinner tridi-"+this.elementName+"-spinner",t.appendChild(e),this.viewer().appendChild(t)},t.prototype.setLoadingState=function(t){this.getLoadingScreen().style.display=t?"block":"none"},t.prototype.generateStash=function(){if(!this.stash()){this.stashedImgs=0;var t=document.createElement("div");t.style.display="none",t.classList.add("tridi-stash"),this.viewer().appendChild(t)}},t.prototype.destroyStash=function(){this.stashedImgs=0,this.stash().parentNode.removeChild(this.stash())},t.prototype.displayHintOnStartup=function(s){var n=this;if(this.hintOnStartup){var a="tridi-"+this.elementName+"-hint-overlay",t=document.createElement("div");t.className+="tridi-hint-overlay "+a,t.tabIndex=0;var o="tridi-"+this.elementName+"-hint",e=document.createElement("div");e.className+="tridi-hint "+o,this.hintText&&(e.innerHTML='<span class="tridi-hint-text tridi-'+this.elementName+'-hint-text">'+this.hintText+"</span>"),t.appendChild(e),this.viewer().appendChild(t);var i=function(t){var e=t.target.classList.contains(a),i=t.target.classList.contains(o);(e||i)&&(n.getHintOverlay().style.display="none",s(),n.focusOnHintClose&&n.viewerImage().focus())};document.addEventListener("click",i),this.touch&&document.addEventListener("touchstart",i),document.addEventListener("keydown",function(t){"Enter"===t.key&&i(t)})}else s()},t.prototype.stashImage=function(t,e,i,s){var n=new Image;n.src=e,n.className+="tridi-image tridi-image-"+(i+1),t.innerHTML+=n.outerHTML,n.onload=s.bind(this)},t.prototype.populateStash=function(){var i=this,s=this.stash(),n=this.imgs();s&&n&&n.forEach(function(t,e){i.stashImage(s,t,e,function(){i.stashedImgs+=1,i.stashedImgs===n.length&&i.setLoadingState(!1)})})},t.prototype.generateViewerImage=function(){var t=this.viewer(),e=this.image(1),i=new Image;i.src=e,i.className+="tridi-viewer-image tridi-"+this.elementName+"-viewer-image",i.setAttribute("draggable","false"),i.setAttribute("alt",""),t.innerHTML=""+i.outerHTML+t.innerHTML},t.prototype.updateViewerImage=function(t){this.viewerImage().src=this.image(t)},t.prototype.nextFrame=function(){this.imageIndex=this.imageIndex<=1?this.count:this.imageIndex-1,this.viewerImage().src=this.image(this.imageIndex)},t.prototype.prevFrame=function(){this.imageIndex=this.imageIndex>=this.count?1:this.imageIndex+1,this.viewerImage().src=this.image(this.imageIndex)},t.prototype.nextMove=function(){return this.inverse?this.prevFrame():this.nextFrame()},t.prototype.prevMove=function(){return this.inverse?this.nextFrame():this.prevFrame()},t.prototype.rotateViewerImage=function(t){var e=t.touches?this.touchDragInterval:this.dragInterval,i=(t.touches?t.touches[0].clientX:t.clientX)-this.viewerImage().offsetLeft;if(this.moveBuffer.length<2)this.moveBuffer.push(i);else{var s=this.moveBuffer[1];this.moveBuffer[1]=i,this.moveBuffer[0]=s}var n=!(i%e),a=this.moveBuffer[0],o=this.moveBuffer[1];n&&(o<a?this.nextMove():a<o&&this.prevMove())},t.prototype.startDragging=function(){this.dragActive=!0,this.viewer().classList.add("tridi-dragging")},t.prototype.stopDragging=function(){this.dragActive=!1,this.viewer().classList.remove("tridi-dragging")},t.prototype.resetMoveBuffer=function(){this.moveBuffer.length=0},t.prototype.attachCosmeticEvents=function(){var t=this.viewer();t.addEventListener("mouseenter",function(){return t.classList.add("tridi-viewer-hovered")}),t.addEventListener("mouseleave",function(){return t.classList.remove("tridi-viewer-hovered")})},t.prototype.attachDragEvents=function(){var e=this;if(this.draggable){var t=this.viewerImage();t.addEventListener("mousedown",function(t){t.preventDefault&&t.preventDefault(),e.startDragging(),e.rotateViewerImage(t)}),t.addEventListener("mouseup",function(t){t.preventDefault&&t.preventDefault(),e.stopDragging(),e.resetMoveBuffer()}),t.addEventListener("mousemove",function(t){e.dragActive&&e.rotateViewerImage(t)}),t.addEventListener("mouseleave",function(){e.resetMoveBuffer()})}},t.prototype.attachMouseLeaveDetection=function(){var t=this;this.mouseleaveDetect&&this.viewer().addEventListener("mouseleave",function(){t.stopDragging(),t.resetMoveBuffer()})},t.prototype.attachTouchEvents=function(){var e=this;if(this.touch){var t=this.viewerImage();t.addEventListener("touchstart",function(t){e.startDragging(),e.rotateViewerImage(t)},{passive:!0}),t.addEventListener("touchmove",function(t){e.rotateViewerImage(t)},{passive:!0}),t.addEventListener("touchend",function(){e.stopDragging(),e.resetMoveBuffer()})}},t.prototype.attachMousewheelEvents=function(){var e=this;this.mousewheel&&this.viewerImage().addEventListener("wheel",function(t){t.preventDefault&&!e.passive&&t.preventDefault(),0<t.deltaY/120?e.nextMove():e.prevMove()},{passive:this.passive})},t.prototype.attachKeyEvents=function(){var e=this;this.keys&&(this.viewerImage().setAttribute("tabindex","0"),this.viewerImage().addEventListener("keydown",function(t){"ArrowLeft"===t.key&&e.prevMove(),"ArrowRight"===t.key&&e.nextMove()}))},t.prototype.clearIntervals=function(){this.intervals.forEach(clearInterval),this.intervals.length=0},t.prototype.setAutoplayInterval=function(){var t=window.setInterval(this.nextMove.bind(this),this.autoplaySpeed);this.intervals.push(t)},t.prototype.clearTimeouts=function(){this.timeouts.forEach(clearTimeout),this.timeouts.length=0},t.prototype.setAutoplayTimeout=function(){var t=window.setTimeout(this.setAutoplayInterval.bind(this),this.resumeAutoplayDelay);this.timeouts.push(t)},t.prototype.toggleAutoplay=function(t,e){t?(this.clearTimeouts(),0===this.intervals.length&&(e?this.setAutoplayInterval():this.setAutoplayTimeout())):this.clearIntervals()},t.prototype.stopAutoplaySequence=function(){this.clearTimeouts(),this.toggleAutoplay(!1)},t.prototype.startAutoplay=function(){var e=this;if(this.autoplay&&(this.toggleAutoplay(!0,!0),this.stopAutoplayOnClick&&(this.viewerImage().addEventListener("mousedown",this.stopAutoplaySequence.bind(this)),this.touch&&this.viewerImage().addEventListener("touchstart",this.stopAutoplaySequence.bind(this),{passive:this.passive})),this.stopAutoplayOnMouseenter&&this.viewerImage().addEventListener("mouseenter",this.stopAutoplaySequence.bind(this)),this.resumeAutoplayOnMouseleave)){var t=this.viewerImage();t.addEventListener("mouseleave",function(t){t.target.classList.contains("tridi-btn")||e.toggleAutoplay(!0)}),this.touch&&t.addEventListener("touchend",function(t){t.target.classList.contains("tridi-btn")||e.toggleAutoplay(!0)})}},t.prototype.attachEvents=function(){this.attachCosmeticEvents(),this.attachDragEvents(),this.attachMouseLeaveDetection(),this.attachTouchEvents(),this.attachMousewheelEvents(),this.attachKeyEvents()},t.prototype.start=function(){var t=this;this.generateViewer(),this.generateLoadingScreen(),this.setLoadingState(!0),this.generateViewerImage(),this.setLoadingState(!1),this.displayHintOnStartup(function(){t.lazyLoad(function(){t.setLoadingState(!0),t.generateStash(),t.populateStash(),t.setLoadingState(!0),t.attachEvents(),t.startAutoplay(),t.setLoadingState(!1)})})},t.prototype.next=function(){this.nextMove()},t.prototype.prev=function(){this.prevMove()},t.prototype.autoplayStart=function(){this.toggleAutoplay(!0)},t.prototype.autoplayStop=function(){this.toggleAutoplay(!1)},t.prototype.update=function(t,e){this.validateUpdate(t)&&(this.setLoadingState(!0),this.updateOptions(t),this.destroyStash(),this.generateStash(),this.populateStash(),this.setLoadingState(!0),this.updateViewerImage(e?this.imageIndex:1),this.attachEvents(),this.setLoadingState(!1))},t.prototype.load=function(){this.start()},t}();"undefined"!=typeof module&&(module.exports=Tridi);