/*
  Tridi v0.0.10 - JavaScript 360 3D Product Viewer
  Author: Lukasz Wojcik
  License: MIT
  Homepage: https://tridi.lukem.net
  GitHub: http://github.com/lukemnet/tridi
*/
var Tridi=function(){function t(t){this.validate=function(t){t.element||console.error("'element' property is missing or invalid. Container element must be specified."),void 0===t.images&&void 0===t.format&&console.error("'format' 2property is missing or invalid. Image format must be provided for 'numbered' property."),"numbered"!==t.images||t.location||console.error("'location' property is missing or invalid. Image location must be provided for 'numbered' property.")},this.validate(t),this.element=t.element,this.images=t.images||"numbered",this.format=t.format||void 0,this.location=t.location||"./images",this.count=Array.isArray(this.images)?this.images.length:t.count,this.draggable=void 0===t.draggable||t.draggable,this.hintOnStartup=t.hintOnStartup||!1,this.hintText=t.hintText||null,this.lazy=t.lazy||!1,this.autoplay=t.autoplay||!1,this.autoplaySpeed=void 0!==t.autoplaySpeed?t.autoplaySpeed:50,this.stopAutoplayOnClick=t.stopAutoplayOnClick||!1,this.stopAutoplayOnMouseenter=t.stopAutoplayOnMouseenter||!1,this.resumeAutoplayOnMouseleave=t.resumeAutoplayOnMouseleave||!1,this.resumeAutoplayDelay=t.resumeAutoplayDelay||0,this.scroll=t.scroll||!1,this.passive=void 0===t.passive||t.passive,this.spinner=t.spinner||!1,this.touch=void 0===t.touch||t.touch,this.mousewheel=t.mousewheel||!1,this.wheelInverse=t.wheelInverse||!1,this.inverse=t.inverse||!1,this.dragInterval=t.dragInterval||1,this.touchDragInterval=t.touchDragInterval||2,this.mouseleaveDetect=void 0!==t.mouseleaveDetect&&t.mouseleaveDetect,this.imageIndex=1,this.moveBuffer=[],this.dragActive=!1,this.intervals=[],this.timeouts=[]}return t.prototype.validateUpdate=function(t){return!!(t.images||t.format||t.count||t.location)||(console.error("UpdatableOptions object doesn't contain options that can be updated."),!1)},t.prototype.updateOptions=function(e){var i=this;Object.keys(e).forEach(function(t){i[t]=e[t]})},t.prototype.getElem=function(t,e){return document.querySelector(this.element+(e?" ":"")+(t||""))},t.prototype.container=function(){return this.getElem()},t.prototype.viewer=function(){return this.getElem(".tridi-viewer")},t.prototype.stash=function(){return this.getElem(".tridi-stash",!0)},t.prototype.getHintOverlay=function(){return this.getElem(".tridi-hint-overlay",!0)},t.prototype.getLoadingScreen=function(){return this.getElem(".tridi-loading",!0)},t.prototype.image=function(t){return this.imgs()[t-1]},t.prototype.viewerImage=function(){return this.getElem(".tridi-viewer .tridi-viewer-image")},t.prototype.lazyLoad=function(t,e){this.lazy&&!e?(this.viewerImage().addEventListener("click",t),this.touch&&this.viewerImage().addEventListener("touchstart",t,{passive:this.passive})):t()},t.prototype.imgs=function(){var i=this;return"numbered"===this.images?Array.apply(null,{length:this.count}).map(function(t,e){return i.location+"/"+(e+1)+"."+i.format.toLowerCase()}):this.images},t.prototype.generateViewer=function(){var t=this.container();if(t){var e=this.element.substr(1);t.className+=" tridi-viewer tridi-"+e+"-viewer tridi-draggable-"+this.draggable+" tridi-touch-"+this.touch+" tridi-mousewheel-"+this.mousewheel+" tridi-hintOnStartup-"+this.hintOnStartup+" tridi-lazy-"+this.lazy}},t.prototype.generateLoadingScreen=function(){var t=document.createElement("div");t.className="tridi-loading",t.style.display="none";var e=document.createElement("div");e.className="tridi-spinner",t.appendChild(e),this.viewer().appendChild(t)},t.prototype.setLoadingState=function(t){this.getLoadingScreen().style.display=t?"block":"none"},t.prototype.generateStash=function(){if(!this.stash()){var t=document.createElement("div");t.classList.add("tridi-stash"),t.style.display="none",this.viewer().appendChild(t)}},t.prototype.destroyStash=function(){this.stash().parentNode.removeChild(this.stash())},t.prototype.displayHintOnStartup=function(s){var n=this;if(this.hintOnStartup){var t=this.element.substr(1),a="tridi-"+t+"-hint-overlay",e=document.createElement("div");e.className+="tridi-hint-overlay "+a,e.tabIndex=0;var o="tridi-"+t+"-hint",i=document.createElement("div");i.className+="tridi-hint "+o,this.hintText&&(i.innerHTML='<span class="tridi-hint-text">'+this.hintText+"</span>"),e.appendChild(i),this.viewer().appendChild(e);var r=function(t){var e=t.target.classList.contains(a),i=t.target.classList.contains(o);(e||i)&&(n.getHintOverlay().style.display="none",s())};document.addEventListener("click",r),this.touch&&document.addEventListener("touchstart",r),document.addEventListener("keydown",function(t){"Enter"===t.key&&r(t)})}else s()},t.prototype.populateStash=function(){var i=this.stash(),t=this.imgs();i&&t&&t.forEach(function(t,e){i.innerHTML+='<img src="'+t+'" class="tridi-image tridi-image-'+(e+1)+'" alt="" />'})},t.prototype.generateViewerImage=function(){var t=this.viewer(),e=this.image(1);t.innerHTML='<img src="'+e+'" alt="" class="tridi-viewer-image" draggable="false" />'+t.innerHTML},t.prototype.updateViewerImage=function(t){this.viewerImage().src=this.image(t)},t.prototype.nextFrame=function(){this.imageIndex=this.imageIndex<=1?this.count:this.imageIndex-1,this.viewerImage().src=this.image(this.imageIndex)},t.prototype.prevFrame=function(){this.imageIndex=this.imageIndex>=this.count?1:this.imageIndex+1,this.viewerImage().src=this.image(this.imageIndex)},t.prototype.nextMove=function(){return this.inverse?this.prevFrame():this.nextFrame()},t.prototype.prevMove=function(){return this.inverse?this.nextFrame():this.prevFrame()},t.prototype.rotateViewerImage=function(t){var e=t.touches?this.touchDragInterval:this.dragInterval,i=(t.touches?t.touches[0].clientX:t.clientX)-this.viewerImage().offsetLeft;if(this.moveBuffer.length<2)this.moveBuffer.push(i);else{var s=this.moveBuffer[1];this.moveBuffer[1]=i,this.moveBuffer[0]=s}var n=!(i%e),a=this.moveBuffer[0],o=this.moveBuffer[1];n&&(o<a?this.nextMove():a<o&&this.prevMove())},t.prototype.startDragging=function(){this.dragActive=!0},t.prototype.stopDragging=function(){this.dragActive=!1},t.prototype.resetMoveBuffer=function(){this.moveBuffer.length=0},t.prototype.attachCosmeticEvents=function(){var t=this.viewer(),e=function(){return t.classList.toggle("tridi-viewer-hovered")};t.addEventListener("mouseenter",e),t.addEventListener("mouseleave",e)},t.prototype.attachDragEvents=function(){var e=this;if(this.draggable){var t=this.viewerImage();t.addEventListener("mousedown",function(t){t.preventDefault&&t.preventDefault(),e.startDragging(),e.rotateViewerImage(t)}),t.addEventListener("mouseup",function(t){t.preventDefault&&t.preventDefault(),e.stopDragging(),e.resetMoveBuffer()}),t.addEventListener("mousemove",function(t){e.dragActive&&e.rotateViewerImage(t)}),t.addEventListener("mouseleave",function(){e.resetMoveBuffer()})}},t.prototype.attachMouseLeaveDetection=function(){var t=this;this.mouseleaveDetect&&this.viewer().addEventListener("mouseleave",function(){t.stopDragging(),t.resetMoveBuffer()})},t.prototype.attachTouchEvents=function(){var e=this;if(this.touch){var t=this.viewerImage();t.addEventListener("touchstart",function(t){e.startDragging(),e.rotateViewerImage(t)},{passive:!0}),t.addEventListener("touchmove",function(t){e.rotateViewerImage(t)},{passive:!0}),t.addEventListener("touchend",function(){e.stopDragging(),e.resetMoveBuffer()})}},t.prototype.attachMousewheelEvents=function(){var e=this;this.mousewheel&&this.viewerImage().addEventListener("wheel",function(t){t.preventDefault&&!e.passive&&t.preventDefault(),0<t.deltaY/120?e.nextMove():e.prevMove()},{passive:this.passive})},t.prototype.clearIntervals=function(){this.intervals.forEach(clearInterval),this.intervals.length=0},t.prototype.setAutoplayInterval=function(){var t=window.setInterval(this.nextMove.bind(this),this.autoplaySpeed);this.intervals.push(t)},t.prototype.clearTimeouts=function(){this.timeouts.forEach(clearTimeout),this.timeouts.length=0},t.prototype.setAutoplayTimeout=function(){var t=window.setTimeout(this.setAutoplayInterval.bind(this),this.resumeAutoplayDelay);this.timeouts.push(t)},t.prototype.toggleAutoplay=function(t,e){t?(this.clearTimeouts(),0===this.intervals.length&&(e?this.setAutoplayInterval():this.setAutoplayTimeout())):this.clearIntervals()},t.prototype.startAutoplay=function(){var e=this;this.autoplay&&(this.toggleAutoplay(!0,!0),this.stopAutoplayOnClick&&this.viewerImage().addEventListener("mousedown",function(){e.toggleAutoplay(!1)}),this.stopAutoplayOnMouseenter&&this.viewerImage().addEventListener("mouseenter",function(){e.toggleAutoplay(!1)}),this.resumeAutoplayOnMouseleave&&this.viewerImage().addEventListener("mouseleave",function(t){t.target.classList.contains("tridi-btn")||e.toggleAutoplay(!0)}))},t.prototype.attachEvents=function(){this.attachCosmeticEvents(),this.attachDragEvents(),this.attachMouseLeaveDetection(),this.attachTouchEvents(),this.attachMousewheelEvents()},t.prototype.start=function(){var t=this;this.generateViewer(),this.generateLoadingScreen(),this.setLoadingState(!0),this.generateViewerImage(),this.setLoadingState(!1),this.displayHintOnStartup(function(){t.lazyLoad(function(){t.setLoadingState(!0),t.generateStash(),t.populateStash(),t.attachEvents(),t.startAutoplay(),t.setLoadingState(!1)})})},t.prototype.next=function(){this.nextMove()},t.prototype.prev=function(){this.prevMove()},t.prototype.autoplayStart=function(){this.toggleAutoplay(!0)},t.prototype.autoplayStop=function(){this.toggleAutoplay(!1)},t.prototype.update=function(t,e){this.validateUpdate(t)&&(this.setLoadingState(!0),this.updateOptions(t),this.destroyStash(),this.generateStash(),this.populateStash(),this.updateViewerImage(e?this.imageIndex:1),this.attachEvents(),this.setLoadingState(!1))},t.prototype.load=function(){this.start()},t}();"undefined"!=typeof module&&(module.exports=Tridi);